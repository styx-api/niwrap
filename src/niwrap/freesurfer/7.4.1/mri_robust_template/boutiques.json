{
  "name": "mri_robust_template",
  "author": "FreeSurfer Developers",
  "description": "Constructs an unbiased robust template for longitudinal volumes using an iterative method.",
  "command-line": "mri_robust_template [MOV] [TEMPLATE] [SAT] [SATIT] [LTA] [MAPMOV] [MAPMOVHDR] [WEIGHTS] [ONEMINUSW] [AVERAGE] [INITTP] [FIXTP] [ISCALE] [ISCALEONLY] [ISCALEIN] [ISCALEOUT] [TRANSONLY] [AFFINE] [IXFORMS] [MASKS] [VOX2VOX] [LEASTSQUARES] [NOIT] [MAXIT] [HIGHIT] [EPSIT] [PAIRMAXIT] [PAIREPSIT] [SUBSAMPLE] [NOMULTI] [FLOATTYPE] [FINALNEAREST] [DOUBLEPREC] [CRAS] [RES_THRESH] [FROBNORM_THRESH] [CONFORM] [SEED] [ALLOW_DIFF_VOX_SIZE] [THREADS] [DEBUG]",
  "schema-version": "0.5+styx",
  "inputs": [
    {
      "id": "mov",
      "name": "Movable Volumes",
      "description": "Input movable volumes to be aligned to common mean/median template (at least 2 required).",
      "value-key": "[MOV]",
      "type": "File",
      "list": true,
      "optional": false,
      "command-line-flag": "--mov"
    },
    {
      "id": "template",
      "name": "Template Output",
      "description": "Output template volume (final mean/median image).",
      "value-key": "[TEMPLATE]",
      "type": "String",
      "optional": false,
      "command-line-flag": "--template"
    },
    {
      "id": "sat",
      "name": "Outlier Sensitivity",
      "description": "Set outlier sensitivity manually. Higher values mean less sensitivity.",
      "value-key": "[SAT]",
      "type": "Number",
      "optional": true,
      "command-line-flag": "--sat"
    },
    {
      "id": "satit",
      "name": "Auto-detect Sensitivity",
      "description": "Auto-detect good sensitivity (recommended for head or full brain scans).",
      "value-key": "[SATIT]",
      "type": "Flag",
      "command-line-flag": "--satit"
    },
    {
      "id": "lta",
      "name": "Output Transforms",
      "description": "Output LTA transforms to template (one per input volume).",
      "value-key": "[LTA]",
      "type": "String",
      "list": true,
      "optional": true,
      "command-line-flag": "--lta"
    },
    {
      "id": "mapmov",
      "name": "Mapped Movables",
      "description": "Output mapped and resampled images in template space (one per input volume).",
      "value-key": "[MAPMOV]",
      "type": "String",
      "list": true,
      "optional": true,
      "command-line-flag": "--mapmov"
    },
    {
      "id": "mapmovhdr",
      "name": "Header-adjusted Movables",
      "description": "Output header-adjusted movable images (no resampling, only vox2ras adjusted).",
      "value-key": "[MAPMOVHDR]",
      "type": "String",
      "list": true,
      "optional": true,
      "command-line-flag": "--mapmovhdr"
    },
    {
      "id": "weights",
      "name": "Outlier Weights",
      "description": "Output weight volumes in template space (0=regular, 1=outlier).",
      "value-key": "[WEIGHTS]",
      "type": "String",
      "list": true,
      "optional": true,
      "command-line-flag": "--weights"
    },
    {
      "id": "oneminusw",
      "name": "Invert Weights",
      "description": "Invert outlier weight map (0=outlier), as in earlier versions.",
      "value-key": "[ONEMINUSW]",
      "type": "Flag",
      "command-line-flag": "--oneminusw"
    },
    {
      "id": "average",
      "name": "Average Type",
      "description": "Construct template from: 0=mean, 1=median (default 1).",
      "value-key": "[AVERAGE]",
      "type": "Number",
      "integer": true,
      "optional": true,
      "command-line-flag": "--average"
    },
    {
      "id": "inittp",
      "name": "Initial Timepoint",
      "description": "Use timepoint number for spatial initialization (default: random). 0 constructs template from original volumes without initialization.",
      "value-key": "[INITTP]",
      "type": "Number",
      "integer": true,
      "optional": true,
      "command-line-flag": "--inittp"
    },
    {
      "id": "fixtp",
      "name": "Fix Timepoint",
      "description": "Map everything to initial timepoint (init TP is not resampled).",
      "value-key": "[FIXTP]",
      "type": "Flag",
      "command-line-flag": "--fixtp"
    },
    {
      "id": "iscale",
      "name": "Intensity Scaling",
      "description": "Enable intensity scaling (default off).",
      "value-key": "[ISCALE]",
      "type": "Flag",
      "command-line-flag": "--iscale"
    },
    {
      "id": "iscaleonly",
      "name": "Intensity Scaling Only",
      "description": "Only perform intensity scaling (no spatial transformation).",
      "value-key": "[ISCALEONLY]",
      "type": "Flag",
      "command-line-flag": "--iscaleonly"
    },
    {
      "id": "iscalein",
      "name": "Initial Intensity Scales",
      "description": "Input initial intensity scale files.",
      "value-key": "[ISCALEIN]",
      "type": "File",
      "list": true,
      "optional": true,
      "command-line-flag": "--iscalein"
    },
    {
      "id": "iscaleout",
      "name": "Output Intensity Scales",
      "description": "Output final intensity scale files (will activate --iscale).",
      "value-key": "[ISCALEOUT]",
      "type": "String",
      "list": true,
      "optional": true,
      "command-line-flag": "--iscaleout"
    },
    {
      "id": "transonly",
      "name": "Translation Only",
      "description": "Find 3 parameter translation only.",
      "value-key": "[TRANSONLY]",
      "type": "Flag",
      "command-line-flag": "--transonly"
    },
    {
      "id": "affine",
      "name": "Affine Transform",
      "description": "Find 12 parameter affine transform.",
      "value-key": "[AFFINE]",
      "type": "Flag",
      "command-line-flag": "--affine"
    },
    {
      "id": "ixforms",
      "name": "Initial Transforms",
      "description": "Use initial LTA transforms on source ('id' for identity).",
      "value-key": "[IXFORMS]",
      "type": "File",
      "list": true,
      "optional": true,
      "command-line-flag": "--ixforms"
    },
    {
      "id": "masks",
      "name": "Input Masks",
      "description": "Input mask volumes applied to movable images.",
      "value-key": "[MASKS]",
      "type": "File",
      "list": true,
      "optional": true,
      "command-line-flag": "--masks"
    },
    {
      "id": "vox2vox",
      "name": "Vox2Vox Output",
      "description": "Output VOX2VOX LTA file (default is RAS2RAS).",
      "value-key": "[VOX2VOX]",
      "type": "Flag",
      "command-line-flag": "--vox2vox"
    },
    {
      "id": "leastsquares",
      "name": "Least Squares",
      "description": "Use least squares instead of robust M-estimator (for testing only).",
      "value-key": "[LEASTSQUARES]",
      "type": "Flag",
      "command-line-flag": "--leastsquares"
    },
    {
      "id": "noit",
      "name": "No Iteration",
      "description": "Do not iterate, just create first template.",
      "value-key": "[NOIT]",
      "type": "Flag",
      "command-line-flag": "--noit"
    },
    {
      "id": "maxit",
      "name": "Max Iterations",
      "description": "Maximum number of template iterations (default: 6 if >2 timepoints, 5 otherwise).",
      "value-key": "[MAXIT]",
      "type": "Number",
      "integer": true,
      "optional": true,
      "command-line-flag": "--maxit"
    },
    {
      "id": "highit",
      "name": "High Resolution Iterations",
      "description": "Maximum number of iterations on highest resolution (default: -1, use maxit).",
      "value-key": "[HIGHIT]",
      "type": "Number",
      "integer": true,
      "optional": true,
      "command-line-flag": "--highit"
    },
    {
      "id": "epsit",
      "name": "Iteration Convergence Threshold",
      "description": "Stop template iterations when all transform updates fall below this value (default: -1.0, disabled).",
      "value-key": "[EPSIT]",
      "type": "Number",
      "optional": true,
      "command-line-flag": "--epsit"
    },
    {
      "id": "pairmaxit",
      "name": "Pairwise Max Iterations",
      "description": "Maximum number of iterations for pairwise registrations (default: 5).",
      "value-key": "[PAIRMAXIT]",
      "type": "Number",
      "integer": true,
      "optional": true,
      "command-line-flag": "--pairmaxit"
    },
    {
      "id": "pairepsit",
      "name": "Pairwise Convergence Threshold",
      "description": "Stop pairwise registration iterations when transform updates fall below this value (default: 0.01).",
      "value-key": "[PAIREPSIT]",
      "type": "Number",
      "optional": true,
      "command-line-flag": "--pairepsit"
    },
    {
      "id": "subsample",
      "name": "Subsample Threshold",
      "description": "Subsample if voxel dimension exceeds this value on all axes (default: -1, disabled).",
      "value-key": "[SUBSAMPLE]",
      "type": "Number",
      "integer": true,
      "optional": true,
      "command-line-flag": "--subsample"
    },
    {
      "id": "nomulti",
      "name": "Disable Multi-resolution",
      "description": "Do not use multi-resolution (process highest resolution only).",
      "value-key": "[NOMULTI]",
      "type": "Flag",
      "command-line-flag": "--nomulti"
    },
    {
      "id": "floattype",
      "name": "Convert to Float",
      "description": "Convert images to float internally (default: keep input type).",
      "value-key": "[FLOATTYPE]",
      "type": "Flag",
      "command-line-flag": "--floattype"
    },
    {
      "id": "finalnearest",
      "name": "Nearest Neighbor Interpolation",
      "description": "Use nearest neighbor interpolation when creating the final average.",
      "value-key": "[FINALNEAREST]",
      "type": "Flag",
      "command-line-flag": "--finalnearest"
    },
    {
      "id": "doubleprec",
      "name": "Double Precision",
      "description": "Use double precision instead of float internally (large memory usage).",
      "value-key": "[DOUBLEPREC]",
      "type": "Flag",
      "command-line-flag": "--doubleprec"
    },
    {
      "id": "cras",
      "name": "Center at CRAS",
      "description": "Center template at average CRAS instead of average barycenter.",
      "value-key": "[CRAS]",
      "type": "Flag",
      "command-line-flag": "--cras"
    },
    {
      "id": "res_thresh",
      "name": "Resolution Threshold",
      "description": "Volume resolution threshold in mm (default: 0.01).",
      "value-key": "[RES_THRESH]",
      "type": "Number",
      "optional": true,
      "command-line-flag": "--res-thresh"
    },
    {
      "id": "frobnorm_thresh",
      "name": "Frobenius Norm Threshold",
      "description": "Matrix Frobenius norm threshold (default: 0.0001).",
      "value-key": "[FROBNORM_THRESH]",
      "type": "Number",
      "optional": true,
      "command-line-flag": "--frobnorm-thresh"
    },
    {
      "id": "conform",
      "name": "Conform Template",
      "description": "Output conformed template (256^3, 1mm isotropic voxels).",
      "value-key": "[CONFORM]",
      "type": "String",
      "optional": true,
      "command-line-flag": "--conform"
    },
    {
      "id": "seed",
      "name": "Random Seed",
      "description": "Set random seed for target selection (default: 0).",
      "value-key": "[SEED]",
      "type": "Number",
      "integer": true,
      "optional": true,
      "command-line-flag": "--seed"
    },
    {
      "id": "allow_diff_vox_size",
      "name": "Allow Different Voxel Sizes",
      "description": "Allow input volumes with different voxel sizes.",
      "value-key": "[ALLOW_DIFF_VOX_SIZE]",
      "type": "Flag",
      "command-line-flag": "--allow-diff-vox-size"
    },
    {
      "id": "threads",
      "name": "Threads",
      "description": "Set number of OpenMP threads.",
      "value-key": "[THREADS]",
      "type": "Number",
      "integer": true,
      "optional": true,
      "command-line-flag": "--threads"
    },
    {
      "id": "debug",
      "name": "Debug Mode",
      "description": "Show debug output.",
      "value-key": "[DEBUG]",
      "type": "Flag",
      "command-line-flag": "--debug"
    }
  ],
  "output-files": [
    {
      "id": "template_output",
      "name": "Template Output",
      "description": "Output template volume (final mean/median image).",
      "path-template": "[TEMPLATE]"
    },
    {
      "id": "conform_output",
      "name": "Conform Template Output",
      "description": "Output conformed template volume.",
      "path-template": "[CONFORM]"
    }
  ],
  "url": "https://github.com/freesurfer/freesurfer"
}
